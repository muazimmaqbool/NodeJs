//Note: First check previous file: 36,37 and 38.

//JWT token implementation:

➡️ Changes in existing code:
    1️⃣ Signup Route: First we will replace '/' with '/signup' inside personRoutes.js for saving person data via POST request,
        then when we hit this endpoint and will return JWT token after the person registration is successful.
    2️⃣ Login Route: We need a '/login' this route will handle user login and issue a new jwt token upon successful authentication.
    3️⃣ Protected Routes: The routes which have protection/authentication will be accessed only by providing a valid JWT token.
                Right now we have added authentication of localAuthMiddleWare to person route in myNewServer.js file like this:          
                    app.use("/person",localAuthMiddleware, personRoutes);
                    We will replace it, because to access the person routes and its sub routes we need to provide username and password
                    which is complicated and to avoid it we will add jwt authentication to it

➡️ Install jsonwebtoken: npm i jsonwebtoken

➡️ Create JWT Auth middleware (jwtAuthMiddleware):
    This middleware is responsible for authentication via tokens
    1️⃣ new file added jwt.js (here jwt auth middleware logic will be written)
        Inside this file how to verify and how to create jwt is done
    
    2️⃣ using JWT token:
        ->What we want the endpoint inside personRoutes : '/signup' should also return jwt token after success:
        
            Import both the files from jwt.js file inside personRoutes.js:
            const{jwtAuthMiddleware,generateToken}=require("../jwt")
            and then after getting reponse after saving person data do this:
             const token=generateToken(response.username) //generating token
             res.status(200).json({response:response,token:token}) //response and token

             the token in response can be checked in jwt.io

        ➡️ How to set expiry time of a token:
            -> inside generateToken function in jwt.js file do this:
                const generateToken=(userData)=>{
                    return jwt.sign(userData,process.env.JWT_SECRET_KEY,{expiresIn:30}) //gets expired in 30 seconds
                }

    3️⃣ Create a '/login' route which will give token in return in personRoutes.js file
    4️⃣ Protected routes with jwt:
        -> Here i will be adding jwtAuthMiddleware to the route which is used to get list of person i.e '/' route in personRoutes.js
            Inside personRoutes.js file on route '/":
                router.get("/",jwtAuthMiddleware, async (req, res) => {...}
                Now whenever your hit this endpoint i.e /person you need to pass the token in header